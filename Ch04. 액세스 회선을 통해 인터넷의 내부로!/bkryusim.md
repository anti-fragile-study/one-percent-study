# 4. 액세스 회선을 통해 인터넷의 내부로

## 워밍업 문제

- 전기 신호의 속도가 느려지는 이유가 도선 저항으로 인해 전류 속도가 감소해서 그런 줄 알았는데, 감쇠율 문제라는 점이 신기했음
- 광섬유는 빛의 전반사를 이용하기 때문에 외부 자기장에 의한 전자기적 방해가 없어 고속 통신 가능한 듯

## 1) ADSL을 이용한 액세스 회선의 동작

### (1) 인터넷의 기본은 가정이나 회사나 같다

- 인터넷의 기본 동작은 LAN과 동일하나, 장치 간 거리의 스케일이 다름
- 라우터가 너무 많기 때문에 장애에 빠르게 대응하기 위해 라우팅 테이블의 정보를 자동으로 업데이트
- [ASDL은 옛날 기술](https://namu.wiki/w/ADSL)이라고 하고, 요즘에는 p.261에 함께 기술된 [FTTH](https://namu.wiki/w/FTTH)가 기가 인터넷에 이용된다고 함.

### (2) 사용자와 인터넷을 연결하는 액세스 회선

- 인터넷과 LAN을 연결하는 통신 회선
- 전주에 부설된 전화용 금속제 케이블을 이용해 고속 통신
- 상향(업로드)과 하향(속도) 통신 속도가 다름

### (3) ADSL 모델(모뎀 아닐까..?)에서 패킷을 셀로 분할한다

- p.263의 그림이 인상적이었음. 내부가 이런 구조라고 생각해보지 못했음
- 인터넷 접속용 라우터에서 MAC, PPP, PPPoE 헤더를 붙임
- ADSL 모뎀에서 패킷을 작은 셀 단위로 분할
    - 헤더 5바이트, 데이터 48바이트
    - ATM이라는 통신 기술에 사용
- 셀을 이용하면 추가적인 설비 투자 없이 기존 설비를 이용가능했음

### (4) ADSL은 변조 방식으로 셀을 신호화한다

- 사각형 신호(구형파)는 edge 부분이 고주파 성분으로 이루어져 있기 때문에, 해당 부분의 감쇠율이 높아 오류가 생기기 쉬움
- QAM 방식이 ASK와 PSK의 혼합이라는 데에서 혼란. QAM은 Analog Modulation인 줄 알았는데, 디지털 신호에도 적용 가능

#### QAM

- 두 개의 Carrier로 변조하는 방식 ($cos(2\pi f_c t), sin(2\pi f_c t)$)
- 같은 주파수에 위상이 다른 신호를 사용하기 떄문에 2W 대역폭 점유. 대역폭에 장점 가진다.
- Modulation

  $S(t) = m_1(t) cos(2\pi f_c t) + m_2(4) sin(2 \pi f_c t)$
- Demodulation은 Coherent Detection을 사용하기 때문에 AM에 비해 복잡.

  $S(t)cos(2\pi f_c t) = \frac {m_1(t)}{2} + \frac {m_1(t)}{2}cos(4\pi f_c t) + \frac {m_2(t)}{2}sin(4\pi f_c t)$

  $S(t)sin(2\pi f_c t) = \frac {m_2(t)}{2} + \frac {m_1(t)}{2}sin(4\pi f_c t) - \frac {m_2(t)}{2}cos(4\pi f_c t)$
- costas reciever를 이용해 위상 잡음 해결해야할 듯

### (5) ADSL은 파를 많이 사용하여 고속화를 실현한다

- ADSL은 4.3125kHz씩 주파수를 다르게 하여(BandWidth인 듯) 경우의 수를 늘려 고속화
- 잡음이 있는 주파수에 소수의 파를, 잡음이 없는 주파수에 다수의 파를 대응시켜 속도 결정
- 업로드와 다운로드 속도에 서로 다른 수의 파를 이용
- `트레이닝`을 통해 속도 측정 및 파 개수 결정

### (6) 스플리터의 역할

- 전화 회선에서 전화 신호와 ADSL 신호를 분리함.
- LPF를 사용해 높은 주파수인 ADSL 신호가 전화로 들어가는 것을 차단
- 스플리터가 있으면 전화가 회선을 사용하는 상태에 관계없이, 따로 트레이닝을 다시 시도하지 않아도 되어 좋음

### (8) 잡음의 영향

- 전화 케이블은 ADSL의 높은 주파수를 가정하지 않았기 때문에 잡음의 영향을 받기 쉬움
- 여러 주파수로 나뉘어 다수의 파를 사용하기 때문에 하나의 주파수 대역에서 잡음이 발생하더라도 바로 오류로 이어지지는 않음

### (9) DSLAM을 통과하여 BAS에 도달

- DSLAM에서 전기 신호가 셀로 복원
- ADSL 모뎀이 이더넷 인터페이스인 반면 DSLAM은 ATM 인터페이스
- BAS에서 셀을 패킷으로 복원. MAC헤더와 PPPoE 헤더를 버리고 터널링용 라우터에 패킷 전달

## 2) 광섬유를 이용한 액세스 회선(FTTH)

### (1) 광섬유의 기본

- 이중 구조로 되어 있으며, 실린더 형태의 코어를 클래드가 감싼 형태의 도선
- 코어의 굴절률이 높고, 클래드의 굴절률이 낮아 코어로 신호를 전송하면 전반사가 일어남
- 디지털 데이터를 전기 신호로 변환한 후, 포토 다이오드를 이용해 광신호로 변환

### (2) 싱글모드와 멀티모드의 차이

- 입사각이 너무 클 경우 전반사되지 않고 클래드를 통해 사라짐(반대 아닌가??)
- 전반사 시 위상차가 발생할 때, 상쇄되어 사라질 수 있음. 벽에 반사된 수면파에 의해 상쇄되는 경우가 예시
- 입사각이 중요하고, 입사각을 고려하여 코어의 직경이 설계되어 있음
- 최대 케이블 길이도 고려해야 함

#### 싱글모드

- 코어의 직경이 매우 가늘고, 위상이 같은 신호는 하나만 통과
- 빛의 양이 적기 때문에 광원과 수광 소자의 성능이 좋아야함
- 대신 위상차에 의한 파동 상쇄에 의한 신호의 변형이 적음
- 장점밖에 없는걸 보면 당연히 얘가 더 비쌈.

#### 멀티모드

- 코어의 직경이 비교적 넓어 위상이 같은 여러 신호가 동시에 통과할 수 있음
- 빛의 양이 많기 때문에 광원, 특히 수광 소자의 성능이 구려도 빛을 잘 검출함
- 신호의 변형이 싱글모드에 비해 많음
- 반사각이 서로 다른 신호들은 반사각에 따라 도달 속도가 다름.
- 반사각이 작으면 반사 횟수가 작아 코스가 짧아지고, 반사각이 크면 반사횟수가 많아져 도달까지 오래 걸림(반대 아닌가??)
- 신호가 도착하는 시간 폭이 넓어질 경우 오류 발생

### (3) 광섬유를 분기시켜서 비용을 절감한다

- ADSL 대신 가장 가까운 전화국까지 광섬유를 사용하는 것이 FTTH

#### 한개의 광섬유로 사용자측과 가장 가까운 전화국에 접속하는 유형

- 미디어 컨버터에서 이더넷 신호를 광신호로 변환
- 셀 단위로 변한하지 않고 그대로 광신호로 변환
- 광섬유는 BAS 바로 앞의 미디어 컨버터에 연결되어, 패킷으로 변환되어 인터넷으로 전달
- 응답도 마찬가지로 같은 광섬유를 통해 돌아옴
- 이 때 상향, 하향 광신호가 단일 광섬유 속에서 혼합되기 때문에, 두 광신호의 파장을 다중화하여 굴절률의 차이로 신호를 분리(파장 다중)

#### 사용자 부근 전주에 광스플리터를 설치하는 유형

- 광섬유를 분기시켜 복수의 사용자를 연결
- 미디어 컨버터 대신 사용자측에 ONU, BAS측에 OLT 설치
- 복수의 사용자가 사용하기 때문에 타이밍을 조절
- OLT가 ONU에 송신 지시를 내려 지시에 따라 ONU가 송신 동작 수행
- 이 방법은 어떤 장점이 있어서 쓰는거지?

## 3) 액세스 회선으로 이용하는 PPP와 터널링

### (1) 본인 확인과 설정 정보를 통지한다

- PPP를 통해 본인 확인 및 설정값 통지
- 글로벌 주소가 뭔지 몰랐는데 밑에 (4)에 나옴

### (2) 이더넷에서 PPP 메시지를 주고받는 PPPoE

- PPPoE는 PPP를 이더넷에서 하는 것
- 프리앰블? FCS?

### (3) 터널링 기능에 의해 프로바이더 패킷을 전달한다

- 터널링을 이용해 BAS와 라우터 사이 터널 개통
- TCP 커넥션을 이용한 터널링 : 패킷을 그대로 TCP연결된 네트워크에 태워 전달
- 캡슐화를 이용한 터널링 : 패킷 전체(헤더, 바디)를 캡슐로 감싸서 전달
- 어찌되든 패킷을 그대로의 모습으로 운반할 수만 있으면 된다

### (4) 액세스 회선 전체의 동작

- 인터넷 접속용 라우터에 프로바이더가 할당한 사용자명과 패스워드 등록
- Discovery라는 broadcast 방식으로 BAS를 찾는다.(ARP와 유사)
- BAS에 사용자명과 패스워드 보냄(암호화하면 CHAP 안하면 PAP)
- BAS에서 사용자 TCP/IP 설정 정보 통지(접속하는 기기의 IP(이게 글로벌주소), DNS서버 IP, 기본 게이트웨이 IP)
- 인터넷 접속용 라우터가 설정 정보를 라우터 자체에 설정, 인터넷 사용 가능

### (5) IP 어드레스를 할당하지 않는 언넘버드

- 글로벌 IP가 모자랄걸 대비해서 포트끼리 1대1로 연결된 경우 포트마다 IP를 할당할 필요 없이 그냥 중계
- 이것을 unnumbered라고 부름

### (6) 인터넷 접속용 라우터에서 프라이빗 주소를 글로벌 주소로 변환한다

- BAS가 통지한 설정 정보를 라우터에 하기 때문에 PC는 글로벌 주소를 가질 수가 없음
- PC에는 프라이빗 주소를 할당하고 인터넷 접속용 라우터에서 주소 변환 후 중계

## 4) 프로바이더의 내부

### (1) POP와 NOC

- 인터넷은 다수의 프로바이더의 네트워크를 서로 연결한 것
- 사용자의 액세스 회선은 사용자가 계약한 프로바이더의 POP에 연결됨
- POP에서 들어온 패킷이 NOC로 모임
- 두가지의 동작이 다르지 않음. 규모가 큰 POP가 NOC

### (2) 건물 밖은 통신 회선 등으로 접속한다

- 프로바이더의 네트워크에는 매우 많은 패킷이 흐르기 때문에 트위스트 페어 케이블의 한계를 초과하는 경우 광섬유 케이블 사용
- 건물 안은 이렇게 하는데 건물 밖으로 나갈때는 광섬유 사용.
- 근데 유지보수가 힘들어서 대형 프로바이더들만 가능.
- 작은 프로바이더들은 광섬유 회선을 대여하여 사용

## 5) 프로바이더를 경유하여 흐르는 패킷

### (1) 프로바이더끼리의 접속

- 프로바이더들끼리 다 연결되어 있기 때문에 클라이언트와 서버가 서로 어느 프로바이더를 사용하는지 상관없이 라우팅 테이블을 통해 경로를 찾아갈 수 있음

### (2) 프로바이더끼리 경로 정보 교환하기

- 라우터끼리 자동적으로 라우팅 정보를 교환하여 경로를 판단. 이 구조를 BGP라고 부름.

### (3) 사내 네트워크에서 자동 등록하기

- 사내 네트워크는 목적지까지 최단 경로를 찾아 패킷을 중계해야함. 따라서 주변 전체 라우터와 무차별적으로 경로 정보를 공유함
- 서로 다른 프로바이더끼리도 최단 경로를 이용하면, 비용 산정이 어려워지기 때문에 하지 않음.
- 그래서 상대에게서 오는 패킷을 중지하는 구조가 필요함.

### (4) IX

- 프로바이더끼리는 1:1로 접속하는 것이 기본이지만, 프로바이더가 n개인 경우 통신 회선이 (n-1)!개 필요함
- IX를 이용하면 여러 프로바이더가 IX에서 적은 회선으로 패킷을 교환할 수 있음

### (5) IX에서 프로바이더끼리 접속하는 모습

- IX는 굉장히 안전한 건물에 있음
- 거대한 고속 Layer 2 스위치가 IX의 핵심
- NOC에서 광섬유를 이용해 IX에 접속하는 것이 통례
