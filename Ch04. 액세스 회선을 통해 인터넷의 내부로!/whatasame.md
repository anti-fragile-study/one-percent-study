# Chapter 04 액세스 회선을 통해 인터넷의 내부로!

## ADSL 기술을 이용한 액세스 회선의 구조와 동작

LAN에서 사용하는 라우터와 인터넷에서 사용하는 라우터의 동작은 기본적으로 같다. 그러나 인터넷의 경우 네트워크 장치 사이의 거리가 훨씬 길고 중계할 대상도 매우 많으므로 이를 고려해야한다. 라우터에서 중계 대상을 찾는 방법은 동일하지만 패킷을 송신하는 방법이 다르다. 인터넷 접속용 라우터는 액세스 회선의 규칙에 따라 패킷 송신 동작을 실행한다.

액세스 회선은 인터넷과 LAN을 연결하는 통신 회선을 말한다. 그 중 하나는 ADSL로서 일반 전화선을 이용하여 고속 통신을 하는 기술이다. ADSL에서 인터넷 접속용 라우터는 BAS라는 장치에서 사용할 목적으로 MAC 헤더, PPPoE 헤더, PPP 헤더를 붙여 ADSL 모뎀에 패킷을 전송한다.

> 인터넷 접속용 라우터라는 것이 게이트웨이 라우터와 동일한 것일까?

ADSL 모뎀은 받은 패킷을 ATM 셀로 나눈다. ATM 셀은 5바이트 헤더와 48바이트의 데이터의 형태를 띄고 있으며 전화 회선을 사용한 통신 방식인 ATM에서 사용한다.

> 네트워크에는 ATM 셀과 같이 데이터를 쪼개서 전송하는 경우가 잦은 것 같다. Network layer에서 segment를 이야기할 때도 MTU, MSS와 같은 용어가 등장했듯이 말이다.

ADSL 모뎀은 나뉜 ATM 셀을 전기 신호로 변조하여 전기 신호로 변환한다. 이때 변조 방법에는 ASK, PSK, QAM이 있다.

- ASK(진폭 변조 방식)
  - 진폭(amplitude)의 크기를 단계로 나누어 비트를 표현한다.
  - 진폭의 크고 작음의 단계를 늘릴 수록 대응하는 비트 수를 늘릴 수 있다.
  - 신호는 전달 도중 잡음에 의해 파형이 변형되는데, 단계를 너무 많이 늘리면 수신 측에서 인접 단계와 오인할 가능성이 커져 오류의 원인이 된다.
- PSK(위상 변조 방식)
  - 신호의 위상(phase)의 각도를 단계로 나누어 비트를 표현한다.
  - 각도의 단계를 세분화하여 대응하는 비트를 늘릴 수 있다.
  - 각도를 너무 나눠 각도가 가까워지면 판별할 수 없게 되어 오류가 발생하기 쉽다.
- QAM(직교 진폭 변조 방식)
  - ASK와 PSK를 결합하여 진폭과 위상에 각각 비트를 대응시켜 표현한다.
  - 이 또한 ASK와 PSK 같이 단계 수가 너무 증가할 경우 판별하기 어렵다.

주파수가 서로 다른 파를 혼합하여 파를 합성하면 표현할 수 있는 비트가 늘어난다. 수신 측에서는 파형 필터를 사용하여 주파수마다 파를 분리할 수 있다.

ADSL(asymmetric digital subscriber line)은 이름에서 알 수 있듯 비대칭을 나타내는데 이는 다운로드와 업로드의 통신 속도의 비대칭을 나타낸다. 잡음이 없는 주파수의 파에는 다수의 비트를 대응시키고, 잡음이 있는 주파수의 파에는 소수의 비트를 대응시킨다. 다운로드에 사용하는 높은 주파수의 파는 감쇠가 크고 잡음의 영향을 받기 쉬우므로 소수의 비트를 대응시킨다. 따라서 다운로드의 속도를 높이기 위해 많은 수의 파를 사용하는데, 업로드에 사용하는 파의 개수보다 다운로드에 사용하는 파의 개수가 더 많기 때문에 둘의 속도가 다르다.

> 예전에 SKT 인터넷을 썼었는데 게임을 할 때마다 ping이 들쑥날쑥 했다. 어렸던 나는 지식in에 이에 대해 물어봤었고 비대칭 인터넷이 원인이라는 것을 알았다. 그때 당시 우리 집에는 SKT에서 대칭형 인터넷을 사용할 수 없었기 때문에 KT로 변경하였는데 인터넷을 바꾸자마자 거짓말같이 ping 문제는 사라졌다.

ADSL는 일반 전화에 사용하는 전화 선을 사용하므로 전화 신호와 ADSL 신호가 섞일 수밖에 없다. 이를 구분하는 것이 스플리터이다. 스플리터는 수신을 할 때만 둘을 구분하는데, 일정한 주파수를 초과하는 신호를 차단하여 ADSL의 높은 주파수 신호를 차단하는 식으로 구분한다. 그 결과로 전화기에는 전화의 신호만 흐르고 ADSL 모뎀으로 향하는 신호는 섞인 상태로 흘려보낸다. ADSL 모뎀에는 ADSL에 사용하는 주파수에서 벗어난 불필요한 주파수를 차단하는 기능이 있기 때문에 스플리터가 구분할 필요가 없다.

전화국에는 다수의 ADSL 모뎀에 해당하는 기능을 묶어 하나의 케이블에 넣은 DSLAM이라는 장치를 사용하는데 이더넷 인터페이스가 아닌 ATM 인터페이스를 갖는다. 따라서 DSLAM은 ATM 셀의 형태 그대로 후방의 라우터와 데이터를 주고 받는데 패킷 중계 장치 BAS가 ATM 인터페이스를 갖고 있기 때문에 불필요하게 데이터를 변환할 필요가 없기 때문이다.

BAS는 ATM 셀을 패킷으로 복원하여 인터넷의 내부에 중계하는데 앞서 인터넷 접속용 라우터가 MAC 헤더, PPoE 헤더, PPP 헤더를 붙인 이유는 BAS의 인터페이스에 패킷을 건네주기 위해 사용하는 것이다. 이는 이더넷에서 라우터가 패킷을 수신했을 때 MAC 헤더를 제거하는 것과 같다.

## 광섬유를 이용한 액세스 회선

> 물리적인 지식이 다소 있어 당황했지만 그래도 아는 지식을 총동원하여 읽었다. ADSL와 FTTH의 동작 방식의 차이는 알겠는데 그 차이로 인한 장단점을 알 수 없어서 아쉬웠다.

ADSL에서 여러 파형을 합성하여 사용하는 것과 달리 광신호는 밝으면 1을, 어두우면 0을 나타낸다. 디지털 데이터를 광신호로 바로 바꿀 순 없어서 디지털 데이터 → 전기 신호 → 광신호 순으로 바꾼다.

광원에서 나온 빛은 코어를 통과하는데 입사각이 큰 것은 밖으로 누설되고 입사각이 작은 빛이 전반사되어 코어 속을 진행한다. 반사된 빛은 각도에 따라 위상차가 발생하는데 이때 위상이 반대인 파는 서로 상쇄되어 소멸되고 위상이 같은 파는 서로 겹쳐져서 강해진다.

광섬유 코어의 굵기에 따라 싱글모드, 멀티 모드로 구분할 수 있다.

- 싱글 모드
  - 코어의 직경이 작음
  - 입사각이 가장 작은 빛만 진행 가능
  - 코어를 진행하는 빛이 단 하나이기 때문에 빛의 양이 적어 광원이나 수광 소자의 성능이 좋아야함
  - 코어를 진행하는 빛이 단 하나이기 때문에 거리가 달라서 도착 시간에 차이가 생기는 현상이 없기 때문에 케이블 길이에 따른 신호 변형이 없음
  - 장거리 통신에 적합
- 멀티 모드
  - 코어의 직경이 큼
  - 입사각이 작은 순으로 여러 빛이 진행 가능
  - 코어에서 진행하는 빛이 여러 개이므로 빛의 양이 많아 광원이나 수광 소자의 성능이 낮아도 괜찮음
  - 큰 각도로 들어온 빛은 반사 횟수가 많아 진행하는 거리가 길고 작은 각도로 들어온 빛은 반사 횟수가 적어 진행하는 거리가 짧은데, 이러한 차이로 인해 신호가 도착하는 시간이 일정하지 않아 신호의 폭이 넓어지고 이는 신호가 변형되었다는 것을 의미
  - 단거리 통신에 적합

하나의 광섬유로 송신과 수신을 하면 두 개의 광신호가 혼합된다. 이를 해결하기 위해 상향 광신호화 하향 광신호의 파장을 변화하여 전송하고 수신 측에서 프리즘의 원리로 이를 분리하여 데이터를 처리한다. ASDL에선 송신과 수신 모두에서 파장의 합성을 사용하지만 FTTH의 경우 개별적인 송신과 수신에서는 합성하지 않고 광섬유 단위에서 합성한다.

하나의 광섬유를 하나의 사용자가 사용할 수도 있지만 광스플리터를 이용하면 하나의 광섬유로 복수의 사용자를 연결할 수 있다. 이때 충돌이 발생할 수 있는데 사용자 측에 ONU, BAS 측에 OLT이라는 장치를 설치하여 패킷의 충돌을 방지할 수 있다. 이는 OLT이 사용자 측의 ONU에게 송신 지시를 내리고 ONU가 송신 동작을 실행하는 형태로 동작한다.

## 액세스 회선으로 이용하는 PPP와 터널링

### 본인 확인과 설정 정보를 통지한다

ADSL이나 FTTH에서 인터넷을 향해 흘러온 패킷은 액세스 회선을 운영하는 사업자의 BAS로 흘러 들어온다. 인터넷은 다수의 라우터의 연결이다. 따라서 액세스 회선으로 라우터를 연결하는데, 액세스 회선의 한 종류인 ADSL나 FTTH처럼 이에 대응하는 라우터인 BAS가 존재한다. BAS는 일반적인 라우터에서 제공하지 않는 **본인 확인**과 **설정값 통지 기능**을 지원한다. ADSL와 FTTH는 사용자 인증 없이 액세스 할 수 없다. 액세스 하기 위해선 BAS를 통해 본인 확인을 수행해야한다. 이를 위해 BAS는 전화 회선을 이용한 PPP를 발전 시킨 PPPoE이라는 구조를 사용한다.

PPP는 전화 회선을 통해 본인 확인 및 설정 정보를 전달 받는다. 과정은 다음과 같다.

1. [client] 프로바이더의 액세스 포인트에 전화를 건다.
2. [client] 전화가 연결되면 인증 정보를 RAS에 전송한다.
3. [RAS] RADIUS 프로토콜을 이용하여 인증 정보를 인증 서버로 전송한다.
4. [인증 서버] RAS에서 전달 받은 인증 정보를 검증하여 인증 결과를 RAS에 반환한다.
5. [RAS] 인증 결과에 포함된 IP 정보와 같은 설정 정보를 client에게 전송한다.
6. [client] 전달받은 설정 정보로 TCP/IP 통신 준비를 완료한다.

PC가 인터넷에 접속하기 위해선 글로벌 주소가 필요하다. 그런데PPP 방식은 전화번호에 따라 액세스 포인트가 달라지기에 글로벌 주소를 고정할 수 없다. 따라서, 인터넷에 접속하기 전에 글로벌 주소를 설정하는 것이 아니라 인터넷에 접속한 후 인터넷에서 제공하는 설정 정보로 글로벌 주소를 설정한다.

### 이더넷에서 PPP 메시지를 주고받는 PPPoE

ADSL와 FTTH 역시 인터넷에 접속하기 위해선 글로벌 주소가 필요하다. 그러나 ADSL과 FTTH는 사용자와 BAS를 케이블로 고정적으로 접속하므로 본인 확인이 필요가 없다. 그렇다면 왜 BAS에는 본인 인증 기능이 있는 것일까? 이유는 다음과 같다.

- 사용자명에 따라 프로바이더를 전환할 수 있어서 편리
- 인증 정보로 누가 인터넷에 액세스 하고 있는지 파악할 수 있음

또, ADSL와 FTTH에서 PPP가 아닌 PPPoE를 사용하는 이유는 PPP를 사용할 수 없기 때문이다. PPP는 메시지를 운반하기 위해 필요한 정보를 담기 위해 HDLC 프로토콜을 사용한다. 그런데 ADSL와 FTTH는 이를 사용할 수 없는 형태로 되어있기 때문에 HDLC 대신 이더넷 패킷을 이용하여 이와 유사한 형태로 PPP 메시지를 운반한다. 이를 포함하여 이더넷과 PPP의 다른 부분을 보완한 사양을 PPPoE라 한다.

### 터널링 기능에 의해 프로바이더에 패킷을 전달한다

BAS는 터널링 기능을 제공한다. 터널링이란 서로 다른 두 곳을 터널처럼 연결하고 한 쪽에서 데이터를 보내면 다른 한 쪽에서 그대로의 모습이 도착하는 것을 말한다. 이를 이용하면 사용자로부터 프로바이더의 라우터까지 한 개의 길이 만들어져서 사용자의 패킷이 하나의 길을 통해 인터넷의 내부로 들어간다.

```
사용자 <---> BAS <---> ADSL/FTTH 네트워크 <---> 프로바이더 라우터
```

```
사용자 <====================================> 프로바이더 라우터
```

위와 같이 3단계로 구분된 동작을 터널링을 이용하여 한 단계처럼 동작하게 만들 수 있고 이는 액세스 회선이 프로바이더의 라우터까지 연장된다는 것과 같다.

터널링 방식에는 두 가지가 있다.

- TCP 커넥션 터널링: 터널링용 라우터 사이에 TCP 커넥션을 맺고 소켓을 라우터의 포트로 간주하여 패킷을 송수신
- 캡슐화 터널링: 패킷 전체를 헤더로 한 번 더 감싸 패킷을 송수신

> TCP 커넥션 터널링과 캡슐화 터널링의 장단점은 무엇일까?

### 액세스 회선 전체의 동작

PPPoE와 터널링에 대한 이해를 바탕으로 액세스 회선의 전체 동작은 다음과 같다.

1. **client**: 프로바이더가 할당한 인증 정보(사용자명과 패스워드)를 인터넷 접속용 라우터에 등록
2. **인터넷 접속용 라우터**: PPPoE의 Discovery를 따라 브로드캐스트로 RAS의 MAC주소를 탐색 시도
3. **BAS**: 인터넷 접속용 라우터의 브로드캐스트에 응답하여 MAC 주소를 반환
4. **인터넷 접속용 라우터**: 인증 정보를 BAS에 전송 (암호화: CHAP, 평문: PAP)
5. **BAS**: 인증 정보를 검증하고 설정 정보(글로벌 주소, DNS 서버의 IP 주소, 기본 게이트웨이의 IP 주소)를 인터넷 접속용 라우터에 반환
6. **인터넷 접속용 라우터**: BAS 포트에 글로벌 주소 할당, 경로표에 기본 게이트웨이 설정

위 과정을 모두 거치면 패킷을 인터넷에 중계할 수 있는 상태가 된다. 이후 클라이언트에서 인터넷에 액세스하는 패킷이 들어왔을 때 동작 과정은 다음과 같다.

1. 인터넷 접속용 라우터의 경로표에서 패킷의 수신처를 확인
2. 인터넷 접속용 라우터의 경로표에는 BAS만 등록되어있으므로 수신처는 등록되어있지 않음
3. BAS에서 통지받은 기본 게이트웨이로 패킷을 중계

이때 패킷의 송신은 PPPoE를 따르며 MAC, PPPoE, PPP 헤더가 붙는다. 최종 패킷의 형태는 다음과 같다. (대문자는 헤더를 가리킴)

```
MAC + PPPoE + PPP + IP + TCP + data
```

MAC, PPPoE 헤더는 사용자의 패킷이 BAS에 도착할 수 있도록 사용되고 PPP 메시지(PPP 헤더를 포함한 나머지 값)들은 터널링을 이용하여 프로바이더의 라우터에 전달된다.

### IP 어드레스를 할당하지 않는 언넘버드

라우터의 포트끼리 하나의 케이블로 연결하는 상태를 1 대 1의 상태라고 한다. 1 대 1 상태에선 한 쪽에서 송신한 패킷은 예외 없이 반대편으로 도착한다. 따라서 경로표에서 게이트웨이 항목의 값을 바탕으로 중계 대상의 주소를 조사할 필요가 없다. 이에 더해, 중계 대상의 주소를 조사할 필요가 없으므로 게이트웨이 항목에 값을 기록할 필요가 없다. 최종적으로 게이트웨이 항목에 값을 기록할 필요가 없으므로 라우터의 포트에 IP 주소를 할당할 필요도 없다.

> 책에서는 라우터의 포트끼리 하나의 케이블로 연결하는 상태라고 표현했는데 이것이 인터넷 접속용 라우터가 기본 게이트웨이와 케이블로 연결되어있다고 이해하는 것이 바람직한지 모르겠다.

이렇게 1 대 1 형태로 접속된 포트에 IP 주소를 할당하지 않아도 되는 것을 언넘버드라고 한다.

### 인터넷 접속용 라우터에서 프라이비트 주소를 글로벌 주소로 변환한다

BAS가 TCP/IP 설정 정보를 통지하면 글로벌 주소를 할당하고 인터넷에 액세스 할 수 있다. 그런데 인증 과정을 인터넷 접속용 라우터가 수행하게 되면 글로벌 주소는 인터넷 접속용 라우터에 할당된다. 즉, 인터넷에 접속하는 PC는 글로벌 주소를 할당할 수 없다.

이러한 문제를 해결하기 위해 PC의 private address를 인터넷 접속용 라우터에서 public address로 변환하는 과정이 필요하다. 이때, 주소를 변환하는 과정으로 인해 정상적으로 동작하지 않는 애플리케이션이 존재할 수 있는데 이 경우 BAS가 통지하는 PPPoE 메시지를 PC가 받게 구조를 변경하면 된다. 단, 이 경우 인터넷의 패킷이 PC에 직접 도착하므로 보안상의 문제를 고려해야한다.

### PPPoE 이외의 방식

ATM 셀을 사용하는 ADSL은 PPPoA라는 프로토콜을 이용하여 PPPoE와 유사하게 사용할 수 있다. 이더넷 패킷에 PPP 메시지를 저장하는 PPPoE와 달리 PPPoA는 PPP 메시지를 그대로 ATM 셀로 쪼개 저장한다. 이더넷 패킷을 사용하지 않고 ATM 셀을 사용하기 때문에 BAS를 포함한 PPP 메시지를 주고받는 기기들은 ADSL 모뎀과 일체화해야한다. 하지만 PPPoE에 필요한 헤더를 사용하지 않기 때문에 MTU가 길어서 효율성이 높다.

PPPoE와 PPPoA의 단점을 정리하면 다음과 같다.

- PPPoE: PPPoE에 사용하는 헤더로 인해 MTU가 짧아 효율이 낮다.
- PPPoA: ATM 셀을 이용해야하므로 ADSL 모뎀과 라우터를 분리할 수 없다.

만약 인증 기능이 필요하지 않아 PPP를 사용하지 않아도 되는 경우 DHCP를 사용하면 두 문제를 해결할 수 있다. DHCP에서는 인터넷의 패킷을 단순히 주고받기만 하므로 MTU가 짧아지지 않으며 ADSL 모뎀의 의존성도 없앨 수 있다.

## 프로바이더의 내부

### POP와 NOC

인터넷은 다수의 프로바이더의 네트워크를 서로 연결한 것이다. 클라이언트의 패킷은 인터넷 접속용 라우터에서 출발하여 BAS를 거치고 터널링을 통해 프로바이더의 라우터에 도착한다. 프로바이더의 라우터는 POP라는 설비에 설치되어있다. 로바이더의 라우터가 인터넷의 입구이며 이를 통과한 패킷은 비로소 인터넷 세상에 들어온 것이다.

POP에는 여러 종류의 라우터가 설치되어있다.

- 전용 접속 회선과 연결된 라우터
- 다이얼 접속을 위한 RAS 라우터
- PPPoE를 위한 라우터
- PPPoA를 위한 라우터

즉, POP에 연결된 액세스 회선의 유형에 따라 라우터를 구분하여 설치한 모습이다.

액세스 회선을 연결하는 라우터의 경우 접속하는 액세스 회선의 수가 많으므로 다수의 포트를 요구하는 반면 흐르는 패킷의 양은 적다. 이에 반해, 라우터들의 라우터는 다수의 라우터에서 나오는 패킷이 모이는 장소이기 때문에 흐르는 패킷이 매우 많다. 따라서 전자와 후자에 적합한 라우터를 사용해야한다.

NOC는 여러 POP에서 보내는 패킷들이 모여드는 곳이다. 지금까지 구조를 정리하면 다음과 같다.

```
........ ....... ---> POP ----\
                               \
                                \
액세스 회선 - 라우터 -\              \
액세스 회선 - 라우터 ---> POP --------------> NOC
액세스 회선 - 라우터 -/              /
                                /
                               /
........ ....... ---> POP ----/
```

한편 POP 겸용으로 사용되는 NOC도 있기 때문에 NOC와 POP는 엄밀하게 구분할 수 없다. 규모가 큰 POP를 NOC로 생각하는 편이 좋다.

### 건물 밖은 통신 회선 등으로 접속한다

건물 내의 네트워크는 트위스트 페어 케이블이나 광섬유를 사용하여 패킷을 전달할 수 있다. 이처럼 서로 다른 건물의 NOC와 POP 사이의 네트워크 또한 광섬유로 연결한다. 다만 이러한 설비를 구성하는데 많은 비용이 들기 때문에 소규모의 프로바이더는 대형 프로바이더의 광섬유를 빌려 사용한다.

광섬유를 빌려서 사용한다는 것이 광섬유 전체를 사용하는 것은 아니다. 광섬유를 소유한 회사는 하나의 광섬유를 세분화하여 사용한다. 즉, 하나의 광섬유에서 여러 종류의 데이터를 한 번에 보낼 수 있다. 따라서 광섬유를 빌린다는 것은 하나의 광섬유에서 세분화된 일부를 빌린다고 할 수 있다. 이러한 대여 서비스를 통신 회선이라고 부른다.

> 요즘 알뜰폰을 잘 쓰고 있는데 뉴스에서 알뜰폰 사업자들은 자체 망을 구축하는 것이 아니라 통신 3사의 망을 빌린다고 했다. 이번 절에서 언급한 통신 회선 사업과 유사한 것일까?

> 결국 서로 다른 프로바이더들은 어떻게든 물리적으로 연결되어 있다. 그럼 무선 통신도 기지국에서 무선 데이터를 수신하여 유선으로 보내고 다시 무선 데이터로 뿌리는 과정으로 동작하는 것일까?

## 프로바이더를 경유하여 흐르는 패킷

### 프로바이더끼리의 접속

클라이언트의 패킷이 인터넷 접속용 라우터와 BAS를 거쳐 프로바이더 라우터에 접근했을 때 다음 단계는 패킷의 목적지에 따라 두 가지로 나눌 수 있다.

- 동일한 프로바이더인 경우
- 서로 다른 프로바이더인 경우

동일한 프로바이더의 라우터들은 서로 경로 정보를 교환하고 경로표에 자동으로 등록한다. 따라서 경로표를 검색하다보면 프로바이더 내의 NOC나 POP의 라우터로 중계 대상이 판명된다.

서로 다른 프로바이더의 경우에도 동일하게 동작한다. 프로바이더는 다른 프로바이더와도 경로 정보를 교환하고 경로표에 등록하기 때문이다.

### 프로바이더끼리 경로 정보 교환하기

그렇다면 서로 다른 프로바이더끼리 경로 정보는 어떻게 교환할까? 이는 정말 단순한 방법으로 이루어지는데 한 쪽의 프로바이더가 다른 프로바이더에게 경로 정보를 알려주는 것이다. 예를 들면 다음과 같다.

1. A 프로바이더와 B 프로바이더가 있다.
2. A 프로바이더가 B 프로바이더에게 A 프로바이더의 경로 정보를 알려준다.
3. B 프로바이더는 A 프로바이더의 경로 정보를 경로표에 등록한다.
4. B 프로바이더에서 A 프로바이더로 패킷이 전달된다.
5. A 프로바이더는 B 프로바이더의 패킷으로 B 프로바이더의 경로 정보를 저장한다.

이러한 방법을 BGP라고 하며 경로 정보의 수준에 따라 두 가지로 구분할 수 있다.

- Transit: 모든 인터넷 경로를 전달
- Peer: 각 프로바이더의 경로 정보만 전달

앞서 살펴본 예시에서 A 프로바이더가 C, D 프로바이더의 정보를 안다고 가정하자. Transit 방식의 경우 B는 A 뿐만 아니라 C, D 정보도 모두 알게 된다. 반면, Peer 방식의 경우 B는 A의 정보만 알 수 있다.

### 사내 네트워크에서 자동 등록하기

사내 네트워크에서 경로 정보를 교환할 땐 최단 경로를 찾는 것이 가장 중요하다. 따라서 라우터들은 서로 무차별적으로 경로 정보를 교환한다.

그러나 인터넷의 경우 이러한 방법으로 경로 정보를 교환할 수 없다. 무차별적으로 경로 정보를 교환하면 서로 다른 프로바이더의 패킷이 회선이 유입되는데 이에 대한 비용 청구를 고려해야하기 때문이다. 따라서 인터넷은 최단 경로를 선택하지 않고 의도하지 않은 상대로부터 오는 패킷을 중지하는 구조를 따른다.

> 역시 돈 문제...

프로바이더 간의 경로 정보 교환을 특정 라우터와 1 대 1로 이루어지게 함으로써 경로 정보를 교환하는 상대를 지정할 수 있다. 이러한 구조는 다음과 같은 이점을 갖는다.

- 프로바이더를 특정할 수 있어 비용 청구를 할 수 있다.
- 지정한 프로바이더가 아닌 패킷을 차단할 수 있다.
- 경로 선택시 최단 경로 뿐만 아니라 프로바이더의 종류를 고려할 수 있다.

이러한 구조로 인해 경로 정보를 교환하지 않은 프로바이더끼리는 패킷을 주고받을 수 없다. 그러나 특정 프로바이더와 직접적으로 연결되어있지 않더라도 간접적으로 연결되어있으면 패킷을 주고받을 수 있기 때문에 액세스하지 못하는 경우는 발생하지 않는다.

> 그런 프로바이더는 망했다.

### IX의 필요성

하지만 1 대 1 방식으로 연결하는 방식(mesh topology)은 프로바이더의 수가 늘어나면 날수록 관리해야하는 회선이 많아진다.

> n개의 프로바이더가 있으면 n!개의 연결이 필요하다...

이러한 문제를 해결하기 위해 IX(Internet eXchange)를 사용한다. IX는 star topology의 구조를 가져 mesh 방식의 문제를 해결한다. 

### IX에서 프로바이더끼리 접속하는 모습

이러한 IX의 중심에는 레이어 2 스위치가 존재하고 각 스위치에 프로바이더의 라우터가 연결되어 있는 형태를 띈다.